# Webserv Tester Konfigurationsdatei
# Konfiguration, die auf den /tester Ordner zugeschnitten ist

server {
    # Hauptkonfiguration des Servers
    server_name localhost mytest;
    body_size 200m;
    root static/;
    
    # Fehlerseiten
    error_page 404 static/errors/404.html;
    
	location /cgi-bin {
		root static/cgi-bin;
		cgi_enable on;
		# cgi_path static/cgi-bin/;
		methods GET POST;
	}
    # Standard-Location
    location / {
        index index.html;
        methods GET POST DELETE;
    }

	location /uploads
	{
		autoindex on;
		root static/uploads;
		upload_path static/uploads;
		upload_enable on;
		methods GET POST DELETE;
	}

    # Statische Dateien mit Directory Listing
    location /static {
        root static;
        autoindex on;
        methods GET;
    }
    
    # Prefix Matching Test - verschachtelte Location für das Testen der Prefix-Priorität
    location /static/nested {
        root static/nested;
        index index.html;
        methods GET;
    }
    
    # ========================================
    # REDIRECT-TEST-SUITE
    # ========================================
    
    # 301 Moved Permanently
    location /old-page {
        return 301 /redirect-destination.html;
    }
    
    # 302 Found (Temporary Redirect)
    location /temp-redirect {
        return 302 /redirect-destination.html;
    }
    
    # 303 See Other (ändert immer die Methode zu GET)
    location /see-other {
        return 303 /redirect-destination.html;
    }
    
    # 307 Temporary Redirect (bewahrt die Methode)
    location /temp-redirect-307 {
        return 307 /redirect-destination.html;
    }
    
    # 308 Permanent Redirect (bewahrt die Methode)
    location /perm-redirect-308 {
        return 308 /redirect-destination.html;
    }
    
    # Redirect mit Query String
    location /redirect-with-query {
        return 301 /redirect-destination.html?param1=value1&param2=value2;
    }
    
    # Redirect auf externe URL
    location /external-redirect {
        return 302 https://example.com/;
    }
    
    # Redirect mit Pfadbewahrung
    location /docs/old {
        return 301 /docs/new;
    }
    
    # Redirect zur Wurzel
    location /go-home {
        return 302 /;
    }
    
    # Redirect-Chain-Test - erster Hop
    location /redirect-chain-1 {
        return 302 /redirect-chain-2;
    }
    
    # Redirect-Chain-Test - zweiter Hop
    location /redirect-chain-2 {
        return 302 /redirect-chain-3;
    }
    
    # Redirect-Chain-Test - dritter Hop (endgültiges Ziel)
    location /redirect-chain-3 {
        index index.html;
        methods GET;
    }
    
    # Redirect-Loop-Test - erzeugt eine unendliche Schleife
    location /redirect-loop-1 {
        return 302 /redirect-loop-2;
    }
    
    location /redirect-loop-2 {
        return 302 /redirect-loop-1;
    }
    
    # Relative Redirect Test
    location /relative-redirect {
        return 302 ../other-page;
    }
    
    # Redirect ohne abschließenden Slash
    location /redirect-no-slash {
        return 301 /destination-no-slash;
    }
    
    # Redirect mit abschließendem Slash
    location /redirect-with-slash {
        return 301 /destination-with-slash/;
    }
    # ========================================
    # ENDE DER REDIRECT-TEST-SUITE
    # ========================================
}

# Server für alternative Port-Tests
server {
    listen 8081;
    server_name localhost;
    body_size 2m;
    root static;
    
    location / {
        index index.html;
        methods GET;
    }
}